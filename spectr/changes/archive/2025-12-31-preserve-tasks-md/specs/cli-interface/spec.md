# CLI Interface Delta Specification

## MODIFIED Requirements

### Requirement: Accept Command Structure

The CLI SHALL provide an `accept` command that converts `tasks.md` to
`tasks.jsonc` format with header comments for stable agent manipulation during
implementation.

#### Scenario: Accept command registration

- WHEN the CLI is initialized
- THEN it SHALL include an AcceptCmd struct field tagged with `cmd`
- AND the command SHALL be accessible via `spectr accept`
- AND the command help text SHALL reference tasks.jsonc output

#### Scenario: Accept with change ID

- WHEN user runs `spectr accept <change-id>`
- THEN the system validates the change exists in `spectr/changes/<change-id>/`
- AND the system parses `tasks.md` into structured format
- AND the system writes `tasks.jsonc` with proper schema and header comments
- AND the system preserves `tasks.md` alongside `tasks.jsonc` to maintain
  human-readable source

#### Scenario: Accept with validation

- WHEN user runs `spectr accept <change-id>`
- THEN the system validates the change before conversion
- AND if validation fails, the system aborts
- AND the system displays validation errors

#### Scenario: Accept dry-run mode

- WHEN user runs `spectr accept <change-id> --dry-run`
- THEN the system displays what would be converted
- AND the system does NOT write tasks.jsonc
- AND the system does NOT modify tasks.md

#### Scenario: Accept already accepted change

- WHEN user runs `spectr accept <change-id>` on a change that already has
  tasks.jsonc
- THEN the system regenerates tasks.jsonc from tasks.md (idempotent)
- AND the system preserves tasks.md
- AND the system exits with code 0 (success)

#### Scenario: Accept change without tasks.md

- WHEN user runs `spectr accept <change-id>` on a change without tasks.md
- THEN the system displays an error indicating no tasks.md found
- AND the system exits with code 1

#### Scenario: Both tasks.md and tasks.jsonc exist

- WHEN both tasks.md and tasks.jsonc exist in a change directory
- THEN spectr commands (list, view, archive) SHALL prefer tasks.jsonc as the
  runtime source
- AND tasks.md SHALL be preserved as the human-readable reference
- AND users MAY edit tasks.md and re-run `spectr accept` to regenerate
  tasks.jsonc

## ADDED Requirements

### Requirement: File Coexistence Documentation

The accept command SHALL document that both tasks.md and tasks.jsonc will
coexist after conversion.

#### Scenario: Success message includes both files

- WHEN `spectr accept` completes successfully
- THEN the success message SHALL indicate that both tasks.md and tasks.jsonc
  exist
- AND the message SHALL clarify that tasks.jsonc is the runtime source
- AND the message SHALL note that tasks.md is preserved for reference

#### Scenario: Help text documents preservation

- WHEN user runs `spectr accept --help`
- THEN the help text SHALL mention that tasks.md is preserved alongside
  tasks.jsonc
- AND the help text SHALL explain that tasks.jsonc is used by runtime commands

### Requirement: Slash Command Template Updates

The proposal and apply slash command templates SHALL instruct agents about
proper task file management to prevent editing tasks.md after accept.

#### Scenario: Proposal template instructs header creation

- WHEN the LLM uses the `/spectr:proposal` command
- THEN Step 6 SHALL instruct the LLM to add a header warning to tasks.md
- AND the instruction SHALL provide an example header comment about post-accept
  workflow
- AND the instruction SHALL allow variation in wording (hybrid approach)

#### Scenario: Apply template warns against tasks.md edits

- WHEN the LLM uses the `/spectr:apply` command
- THEN the Steps section SHALL include a reminder not to edit tasks.md
- AND the reminder SHALL direct agents to use tasks.jsonc exclusively for
  progress tracking
- AND the reminder SHALL explain that tasks.md is preserved as read-only
  reference

#### Scenario: Tasks.jsonc header references AGENTS.md

- WHEN tasks.jsonc is generated by `spectr accept`
- THEN the header comment SHALL include a reference to spectr/AGENTS.md
- AND the reference SHALL direct agents to the workflow documentation
- AND the header SHALL note that tasks.md should not be edited for progress
  tracking
