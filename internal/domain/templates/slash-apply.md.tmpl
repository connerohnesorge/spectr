{{define "base_guardrails"}}
- Favor straightforward, minimal implementations first and add complexity only
  when it is requested or clearly required.
- Keep changes tightly scoped to the requested outcome.
- Refer to `{{ .AgentsFile }}` and `{{ .BaseDir }}/project.md` (located inside
  the `{{ .BaseDir }}/` directory—run `ls {{ .BaseDir }}`) if you need
  additional Spectr conventions or clarifications.
{{end}}

{{define "guardrails"}}
## Guardrails

{{template "base_guardrails" .}}
{{end}}

{{define "base_steps"}}
Track these steps as TODOs and complete them one by one.

1. Run `spectr accept <id>` to convert `tasks.md` to `tasks.jsonc` format for
   stable task tracking. Note: Both `tasks.md` (human-readable source) and
   `tasks.jsonc` (runtime source of truth) coexist after accept—update task
   statuses in `tasks.jsonc`.
2. Read `{{ .ChangesDir }}/<id>/proposal.md`, `design.md` (if present), and
   `tasks.jsonc` to confirm scope and acceptance criteria.
3. Work through tasks sequentially, keeping edits minimal and focused on the
   requested change. Update the task status in `tasks.jsonc` after verifying
   the work.
4. Confirm completion before updating statuses—make sure every item in
   `tasks.jsonc` is finished.
5. Verify/Update all task status in `tasks.jsonc` after all work is done. Tasks
   have status values: `pending`, `in_progress`, `completed`.
6. Read `{{ .ChangesDir }}/` and `{{ .SpecsDir }}/` directories when additional
   context is required.
{{end}}

{{define "steps"}}
## Steps

{{template "base_steps" .}}
{{end}}

{{define "base_reference"}}
- Read `{{ .ChangesDir }}/<id>/proposal.md` for proposal details.
- Read `{{ .ChangesDir }}/<id>/specs/<capability>/spec.md` for delta specs.
{{end}}

{{define "reference"}}
## Reference

{{template "base_reference" .}}
{{end}}

{{define "main"}}
# Apply Guide

{{template "guardrails" .}}

{{template "steps" .}}

{{template "reference" .}}
{{end}}

{{template "main" .}}
