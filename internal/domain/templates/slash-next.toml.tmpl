description = "Execute the next pending task in a Spectr change proposal"
agent = ""
model = ""
subtask = false
prompt = """
# Guardrails
- Favor straightforward, minimal implementations first and add complexity only when it is requested or clearly required.
- Keep changes tightly scoped to the requested outcome.
- Refer to `{{ .AgentsFile }}` and `{{ .BaseDir }}/project.md` (located inside the `{{ .BaseDir }}/` directory—run `ls {{ .BaseDir }}`) if you need additional Spectr conventions or clarifications.

# Spectr: Next Task Execution

## Overview

This command automatically executes the next pending task in the current spectr change proposal.

## What This Command Does

1. **Discovers** the change proposal directory in `{{ .ChangesDir }}/`
2. **Parses** the `tasks.jsonc` file to find the first pending task
3. **Executes** the task based on its description
4. **Updates** task status: pending → in_progress → completed
5. **Reports** what was done and what's next

## Steps

1. Read the change proposal ID (argument) or auto-detect from context
2. Read `{{ .ChangesDir }}/<id>/tasks.jsonc` to find the first task with status "pending"
3. Update the task status to "in_progress" in `tasks.jsonc`
4. Read `{{ .ChangesDir }}/<id>/proposal.md` and `design.md` (if present) for context
5. Execute the task based on its description, keeping changes minimal and focused
6. Update the task status to "completed" in `tasks.jsonc`
7. Report what was done and suggest the next task

## Task Discovery
- Supports both v1 flat `tasks.jsonc` files and v2 hierarchical files with `$ref` links
- Automatically follows `$ref` links to child task files
- Includes circular reference detection
- Returns the first task with status "pending"

## Status Management
- Updates task status atomically to prevent corruption
- Handles both flat and hierarchical task structures
- Tasks have status values: `pending`, `in_progress`, `completed`
- Provides clear error messages for common failure scenarios

## Error Handling
- **No pending tasks**: Reports all tasks are completed
- **Malformed tasks.jsonc**: Provides parsing error details
- **Missing $ref files**: Reports which child files are missing
- **Status update failures**: Attempts rollback to previous state

## Best Practices

1. **Always verify** the proposed task before execution
2. **Update status immediately** after starting work
3. **Report progress** clearly and concisely
4. **Handle errors gracefully** with helpful messages
5. **Suggest next steps** after completion

# Reference
- Read `{{ .ChangesDir }}/<id>/proposal.md` for proposal details
- Read `{{ .ChangesDir }}/<id>/tasks.jsonc` for task status
- Read `{{ .ChangesDir }}/<id>/specs/<capability>/spec.md` for delta specs
"""